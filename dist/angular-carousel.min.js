/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.0 - 2014-03-04
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(a){a.prev=function(){a.index--},a.next=function(){a.index++}},template:'<div class="rn-carousel-controls"><span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span><span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span></div>'}}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index,first: $index==0,last: $index==(items.length-1)}"></span></div>'}}]),function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["$swipe","$window","$document","$parse","$compile",function(a,b,c,d,e){var f=0,g=75,h=.05,i=3;return{restrict:"A",scope:!0,compile:function(j,k){var l,m,n=j.children()[0].attributes,o=!1,p=!1,q=!1;return j.addClass("rn-carousel-slides"),j.children().addClass("rn-carousel-slide"),["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(a){var b=n[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(l=c[1],m=c[2],l)return angular.isDefined(k.rnCarouselBuffered)&&(p=!0,b.value=l+" in "+m+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),o=!0,!1}return!0}),function(j,k,l){function n(){for(var a=[],b=0;N>b;b++)a[b]=b;j.carouselIndicatorArray=a}function r(){var a=P.children();return F=0===a.length?P[0].getBoundingClientRect().width:a[0].getBoundingClientRect().width,Math.floor(F)}function s(){Q.css("width","100%"),Q.css("width",r()+"px")}function t(a){isNaN(a)&&(a=j.carouselIndex*F),M=a;var b=-Math.round(M);b+=j.carouselBufferIndex*F,P[0].style[G]="translate3d("+b+"px, 0, 0)"}function u(){var a,b;J&&(a=Date.now()-L,b=J*Math.exp(-a/g),b>i||-i>b?(t(K-b),requestAnimationFrame(u)):x(K/F))}function v(a){return a>=N?N:0>=a?0:a}function w(){var a=0,b=(j.carouselBufferSize-1)/2;p&&(a=j.carouselIndex<=b?0:N<j.carouselBufferSize?0:j.carouselIndex>N-j.carouselBufferSize?N-j.carouselBufferSize:j.carouselIndex-b),j.carouselBufferIndex=a}function x(a,b){return isNaN(a)&&(a=j.carouselIndex),b?(M=a*F,void D(null,null,!0)):(j.carouselIndex=v(a),w(),"$apply"!==j.$$phase&&"$digest"!==j.$$phase&&(q?j.$apply():j.$digest()),void t())}function y(){return h*F}function z(a){O=!0,D({x:a.clientX,y:a.clientY},a)}function A(a){var b=a;return 0===j.carouselIndex?b=Math.max(-y(),b):j.carouselIndex===N-1&&(b=Math.min((N-1)*F+y(),b)),b}function B(a){return c.bind("mouseup",z),H=!0,I=a.x,J=0,L=Date.now(),!1}function C(a){var b,c;return H&&(b=a.x,c=I-b,(c>2||-2>c)&&(O=!0,I=b,requestAnimationFrame(function(){t(A(M+c))}))),!1}function D(a,b,d){if(!b||O){c.unbind("mouseup",z),H=!1,O=!1,K=M;var e=y(),f=j.carouselIndex*F,g=f-K,h=-Math[g>=0?"ceil":"floor"](g/F),i=Math.abs(g)>e;h+j.carouselIndex>=N&&(h=N-1-j.carouselIndex),h+j.carouselIndex<0&&(h=-j.carouselIndex);var k=i?h:0;return K=(k+j.carouselIndex)*F,J=K-M,L=Date.now(),d&&(J=M-f),requestAnimationFrame(u),!1}}function E(){s(),x()}f++;var F,G,H,I,J,K,L,M=0,N=0,O=!1,P=k.wrap("<div id='carousel-"+f+"' class='rn-carousel-container'></div>"),Q=P.parent();if((angular.isDefined(l.rnCarouselIndicator)||angular.isDefined(l.rnCarouselControl))&&(n(),j.$watch("carouselIndex",function(a){j.indicatorIndex=a}),j.$watch("indicatorIndex",function(a){x(a,!0)})),angular.isDefined(l.rnCarouselIndicator)){var R=e("<div id='carousel-"+f+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(j);Q.append(R)}if(angular.isDefined(l.rnCarouselControl)){var S=e("<div id='carousel-"+f+"-controls' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-controls class='rn-carousel-controls'></div>")(j);Q.append(S)}if(j.carouselBufferIndex=0,j.carouselBufferSize=5,j.carouselIndex=0,l.rnCarouselIndex){var T=function(a){U.assign(j.$parent,a)},U=d(l.rnCarouselIndex);angular.isFunction(U.assign)?(j.$watch("carouselIndex",function(a){T(a)}),j.carouselIndex=U(j),j.$parent.$watch(U,function(a){void 0!==a&&(a>=N?(a=N-1,T(a)):0>a&&(a=0,T(a)),x(a,!0))}),q=!0):isNaN(l.rnCarouselIndex)||(j.carouselIndex=parseInt(l.rnCarouselIndex,10))}o?j.$watchCollection(m,function(a){N=0,angular.isArray(a)?N=a.length:angular.isObject(a)&&(N=Object.keys(a).length),n(),F||s(),x(j.carouselIndex)}):(N=k.children().length,n(),s()),l.$observe("rnCarouselSwipe",function(b){"false"!==b&&"off"!==b?a.bind(P,{start:B,move:C,end:D,cancel:function(a){D({},a)}}):P.unbind()}),q||x(j.carouselIndex),G="transform",["webkit","Moz","O","ms"].every(function(a){var b=a+"Transform";return"undefined"!=typeof document.body.style[b]?(G=b,!1):!0});var V=angular.element(b);V.bind("orientationchange",E),V.bind("resize",E),j.$on("$destroy",function(){c.unbind("mouseup",z),V.unbind("orientationchange",E),V.unbind("resize",E)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();